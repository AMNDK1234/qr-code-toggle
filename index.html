<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Multiâ€‘QR Generator</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <style>body{font-family:sans-serif;max-width:600px;margin:auto}</style>
</head>
<body>
<h2>Generate new QR</h2>
<form id="genForm">
  <label>Customâ€¯ID:
    <input required id="qrId" placeholder="myLink01">
  </label><br>
  <label>Destinationâ€¯URL:
    <input required id="qrURL" placeholder="https://â€¦">
  </label><br>
  <button type="submit">CreateÂ &Â Download</button>
</form>

<div id="preview" style="margin-top:20px"></div>

<script type="module">
import status from './status.json' assert { type: 'json' };

const form = document.getElementById('genForm');
form.addEventListener('submit', e=>{
  e.preventDefault();
  const id  = qrId.value.trim();
  const url = qrURL.value.trim();
  if(status.codes[id]) return alert('ID already exists!');
  // 1â€Šâ€“â€ŠGenerate QR â†’ canvas
  const holder = document.getElementById('preview');
  holder.innerHTML = "";
  const qr = new QRCode(holder,{
      text:`./active-page.html?code=${id}`,
      width:256,height:256
  });
  // 2â€Šâ€“â€ŠDownload jpeg
  setTimeout(()=>{
      const canvas = holder.querySelector('canvas');
      const link = document.createElement('a');
      link.download = `${id}.jpeg`;
      link.href = canvas.toDataURL("image/jpeg");
      link.innerText = "ðŸ‘‰ Download JPEG";
      holder.appendChild(document.createElement('br'));
      holder.appendChild(link);
  },200);
  // 3â€Šâ€“â€ŠAppend to local JSON object & POST back to repo via RESTÂ API
  status.codes[id] = {url, active:true};
  updateJSON(status);        // ðŸ”½Â function defined below
});

async function updateJSON(obj){
  const res = await fetch("./toggle.html?update=1",{
      method:"POST",
      headers: {"Content-Type":"application/json"},
      body:JSON.stringify(obj)
  });
  if(res.ok) alert("status.json committed â€“ remember to push if local!");
}
</script>
</body></html>





